<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>结构体</title>
<meta name="generator" content="Org mode" />
<meta name="author" content="Wu, Shanliang" />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { width: 90%; }
  /*]]>*/-->
</style>
<link rel="stylesheet" type="text/css" href="css/main.css" />
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2018 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
</head>
<body>
<div id="org-div-home-and-up">
 <a accesskey="h" href="hashtable.html"> UP </a>
 |
 <a accesskey="H" href="slt.html"> HOME </a>
</div><div id="content">
<h1 class="title">结构体</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#orgd3008f3">向量</a>
<ul>
<li><a href="#orgbaa620d">字面值</a></li>
<li><a href="#org7df0b8e">向量函数</a></li>
</ul>
</li>
<li><a href="#orgb4f6361">结构体</a>
<ul>
<li><a href="#org833381f">MIT-Scheme中的结构体</a></li>
</ul>
</li>
<li><a href="#org876ac6e">实例：简单的密码破解游戏</a>
<ul>
<li><a href="#org60a3ccf">数据结构</a></li>
<li><a href="#orgb1a32cf">设计</a></li>
<li><a href="#orgf9197d1">实现</a></li>
</ul>
</li>
</ul>
</div>
</div>
<p>
本章中，将讲解 <span class="underline">向量</span> 和 <span class="underline">结构体</span> 
</p>

<p>
<span class="underline">向量</span> 是一组通过 <b>整数索引</b> 的数据：
</p>
<ul class="org-ul">
<li>与表相比，向量更加 <b>紧凑</b> 且 <b>存取时间更短</b></li>
<li>但从另外一方面来说，向量是通过 <b>副作用</b> 来操作的</li>
</ul>

<pre class="example">
  与C语言中的数组不同，一个向量可以储存不同类型的数据
</pre>

<p>
Scheme中的 <span class="underline">结构体</span> 与C语言中的 <span class="underline">结构体</span> 类似。但Scheme中的结构体更 <b>容易使用</b> ，因为Scheme为结构体 <b>自动创建</b> 了 <span class="underline">读取</span> 函数和 <span class="underline">写入</span> 函数
</p>
<div class="org-src-container">
<pre class="src src-scheme">  &#36825;&#21463;&#30410;&#20110; Lisp/Scheme &#20013;&#30340;&#23439;
</pre>
</div>
<div id="outline-container-orgd3008f3" class="outline-2">
<h2 id="orgd3008f3">向量</h2>
<div class="outline-text-2" id="text-orgd3008f3">
</div>
<div id="outline-container-orgbaa620d" class="outline-3">
<h3 id="orgbaa620d">字面值</h3>
<div class="outline-text-3" id="text-orgbaa620d">
<p>
<span class="underline">向量</span> 通过 <b>闭合</b> 的 <span class="underline">#(</span> 和 <span class="underline">)</span> 表示，作为 <span class="underline">字面值</span> 时，它们应该 <b>被引用</b> ，例如：
</p>

<pre class="example">
'#(1 2 3)               ; 整数向量
'#(a 0 #\a)           ; 由符号、整数和字符构成的向量
</pre>
</div>
</div>
<div id="outline-container-org7df0b8e" class="outline-3">
<h3 id="org7df0b8e">向量函数</h3>
<div class="outline-text-3" id="text-org7df0b8e">
<p>
下面的函数都是R5RS规定的函数：
</p>
<ul class="org-ul">
<li>(vector? obj) : 如果 <span class="underline">obj</span> 是一个 <b>向量</b> 则返回 <span class="underline">#t</span></li>
<li>(make-vector k fill) : 返回有 <span class="underline">k个元素</span> 的向量
<ul class="org-ul">
<li>如果指定了第二个参数 <span class="underline">fill</span> ，那么所有的元素都会被 <b>初始化</b> 为 <span class="underline">fill</span></li>
</ul></li>
<li>(vector obj …) : 返回由 <span class="underline">参数列表</span> 构成的 <b>向量</b></li>
<li>(vector-length vector): 返回向量 <span class="underline">vector</span> 的 <b>长度</b></li>
<li>(vector-ref vector k) : 返回向量 <span class="underline">vector</span> 的 <b>索引</b> 为 <span class="underline">k</span> 的 <b>元素</b> （向量从 <span class="underline">0</span> 开始索引）</li>
<li>(vector-set! vector k obj): 将向量 <span class="underline">vector</span> 的索引为 <span class="underline">k</span> 的 <b>元素</b> 修改为 <span class="underline">obj</span></li>
<li>(vector-&gt;list vector) : 将 <span class="underline">vector</span> 转换为 <b>表</b></li>
<li>(list-&gt;vector list) 将表 <span class="underline">list</span> 转换为 <b>向量</b></li>
<li>(vector-fill! vector fill) : 将向量 <span class="underline">vector</span> 的 <b>所有元素</b> 设置为 <span class="underline">fill</span></li>
</ul>

<p>
例如，对两个向量中元素求和：
</p>
<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #00bfff; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #daa520; font-weight: bold;">vector-add</span> v1 v2<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #00bfff; font-weight: bold;">let</span> <span style="color: #696969;">((</span>lenv1 <span style="color: #696969;">(</span>vector-length v1<span style="color: #696969;">))</span>
        <span style="color: #696969;">(</span>lenv2 <span style="color: #696969;">(</span>vector-length v2<span style="color: #696969;">)))</span>
    <span style="color: #696969;">(</span><span style="color: #00bfff; font-weight: bold;">if</span> <span style="color: #696969;">(</span>= lenv1 lenv2<span style="color: #696969;">)</span>
        <span style="color: #696969;">(</span><span style="color: #00bfff; font-weight: bold;">let</span> <span style="color: #696969;">((</span>v <span style="color: #696969;">(</span>make-vector lenv1<span style="color: #696969;">)))</span>
          <span style="color: #696969;">(</span><span style="color: #00bfff; font-weight: bold;">let</span> <span style="color: #daa520; font-weight: bold;">loop</span> <span style="color: #696969;">((</span>i 0<span style="color: #696969;">))</span>
            <span style="color: #696969;">(</span><span style="color: #00bfff; font-weight: bold;">if</span> <span style="color: #696969;">(</span>= i lenv1<span style="color: #696969;">)</span>
                v
                <span style="color: #696969;">(</span><span style="color: #00bfff; font-weight: bold;">begin</span>
                  <span style="color: #696969;">(</span>vector-set! v i <span style="color: #696969;">(</span>+ <span style="color: #696969;">(</span>vector-ref v1 i<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>vector-ref v2 i<span style="color: #696969;">)))</span>
                  <span style="color: #696969;">(</span>loop <span style="color: #696969;">(</span>+ 1 i<span style="color: #696969;">))))))</span>
        <span style="color: #696969;">(</span>error <span style="color: #deb887;">"different dimensions."</span><span style="color: #696969;">))))</span>
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-orgb4f6361" class="outline-2">
<h2 id="orgb4f6361">结构体</h2>
<div class="outline-text-2" id="text-orgb4f6361">
<pre class="example">
    虽然 R5RS 中没有定义结构体，但是在很多Scheme实现中，都实现了类似于 Common Lisp 中的结构体
</pre>
<p>
这些结构体本质上来说都是向量。每一个 <b>槽</b> ( <span class="underline">slot</span> )都通过使用一个 <span class="underline">宏</span> 来命名。结构体 <b>通过不同的属性</b> 清楚地 <b>表示数据</b> 
</p>
<pre class="example">
    定义结构体的宏 自动为 结构体 创建 取值器 (accessor) 和赋值器 (setter) 
</pre>
</div>
<div id="outline-container-org833381f" class="outline-3">
<h3 id="org833381f">MIT-Scheme中的结构体</h3>
<div class="outline-text-3" id="text-org833381f">
<p>
在MIT-Scheme中，结构体通过函数 <b>define-structure</b> 来定义。请考虑书籍。书籍都有下列属性：
</p>
<ul class="org-ul">
<li>标题</li>
<li>作者</li>
<li>出版商</li>
<li>出版年份</li>
<li>ISBN号</li>
</ul>

<p>
因此结构体 <span class="underline">book</span> 就可以像下面这样定义：
</p>

<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #696969;">(</span>define-structure book title authors publisher year isbn<span style="color: #696969;">)</span>

<span style="color: #696969;">(</span><span style="color: #00bfff; font-weight: bold;">define</span> <span style="color: #daa520; font-weight: bold;">bazaar</span> 
  <span style="color: #696969;">(</span>make-book 
   <span style="color: #deb887;">"The Cathedral and the Bazaar"</span>
   <span style="color: #deb887;">"Eric S. Raymond"</span>
   <span style="color: #deb887;">"O'Reilly"</span>
   1999
   0596001088<span style="color: #696969;">))</span> <span style="color: #5f9ea0; font-style: italic;">; </span><span style="color: #5f9ea0; font-style: italic;">bazaar</span>
</pre>
</div>

<p>
然而，这样做多少有点不便，因为属性与值的关联并不清楚：
</p>
<ul class="org-ul">
<li>参量 <span class="underline">keyword-constructor</span> 可以用于解决这个问题
<ul class="org-ul">
<li>属性与值的 <b>关联</b> 就非常清楚了</li>
<li>参数的 <b>顺序</b> 就不重要了</li>
</ul></li>
<li>参量 <span class="underline">copier</span> 可用于为结构体创建一个 <b>拷贝</b> 函数</li>
</ul>

<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #696969;">(</span>define-structure <span style="color: #696969;">(</span>book keyword-constructor copier<span style="color: #696969;">)</span> 
  title authors publisher year isbn<span style="color: #696969;">)</span>

<span style="color: #696969;">(</span><span style="color: #00bfff; font-weight: bold;">define</span> <span style="color: #daa520; font-weight: bold;">bazaar</span> 
  <span style="color: #696969;">(</span>make-book 
   'title <span style="color: #deb887;">"The Cathedral and the Bazaar"</span>
   'authors <span style="color: #deb887;">"Eric S. Raymond"</span>
   'publisher <span style="color: #deb887;">"O'Reilly"</span>
   'year 1999    
   'isbn 0596001088<span style="color: #696969;">))</span>
</pre>
</div>

<ul class="org-ul">
<li><b>[the name of structure]?</b> : 检查某对象是否为 <b>特定结构体</b> 。例如，可使用函数 <span class="underline">book?</span> 来检查 <span class="underline">bazaar</span> 是否为 <span class="underline">book结构体</span> 的 <b>一个实例</b> ：</li>
</ul>

<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #696969;">(</span>book? bazaar<span style="color: #696969;">)</span> <span style="color: #5f9ea0; font-style: italic;">; </span><span style="color: #5f9ea0; font-style: italic;">#t </span>
</pre>
</div>

<ul class="org-ul">
<li><b>copy-[structure name]</b> : <b>拷贝</b> 结构体。例如，下面的代码演示了将 <span class="underline">bazaar</span> 拷贝 到 <span class="underline">cathedral</span> ：</li>
</ul>
<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #00bfff; font-weight: bold;">define</span> <span style="color: #daa520; font-weight: bold;">cathedral</span> <span style="color: #696969;">(</span>copy-book bazaar<span style="color: #696969;">))</span> <span style="color: #5f9ea0; font-style: italic;">; </span><span style="color: #5f9ea0; font-style: italic;">cathedral </span>
</pre>
</div>

<ul class="org-ul">
<li><b>[structure name]-[attribute name]</b> : 读取结构体某 <b>属性的值</b> 。例如，下面的代码演示了如何读取 <span class="underline">bazaar</span> 的 <span class="underline">title属性</span> ：</li>
</ul>

<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #696969;">(</span>book-title bazaar<span style="color: #696969;">)</span> <span style="color: #5f9ea0; font-style: italic;">; </span><span style="color: #5f9ea0; font-style: italic;">"The Cathedral and the Bazaar"</span>
</pre>
</div>

<ul class="org-ul">
<li><b>set-[structure name]]-[attribute name]]!</b> :  将某 <b>属性设定</b> 为特定值。下面的代码演示了如何将 <span class="underline">bazaar</span> 的 <span class="underline">year字段</span> 更新到 <span class="underline">2001</span> ：</li>
</ul>

<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #696969;">(</span>book-year bazaar<span style="color: #696969;">)</span> <span style="color: #5f9ea0; font-style: italic;">; </span><span style="color: #5f9ea0; font-style: italic;">1999   </span>
<span style="color: #696969;">(</span>set-book-year! bazaar 2001<span style="color: #696969;">)</span>
<span style="color: #696969;">(</span>book-year bazaar<span style="color: #696969;">)</span> <span style="color: #5f9ea0; font-style: italic;">; </span><span style="color: #5f9ea0; font-style: italic;">2001</span>
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-org876ac6e" class="outline-2">
<h2 id="org876ac6e">实例：简单的密码破解游戏</h2>
<div class="outline-text-2" id="text-org876ac6e">
<p>
作为向量的示例，我们演示一个简单的密码破解游戏。这是一个猜对手密码的游戏。密码是由 0到 9中四个不同的数组成的四位数。对手要通过使用 bulls和 cows 的数量告知猜谜者猜测的准确程度
</p>
<ul class="org-ul">
<li>bull 的数量 (Nbull) 是指值和位置都正确的数字的数量</li>
<li>cow的数量 (Ncow) 是指值正确但位置错误的数字的数量。</li>
</ul>

<pre class="example">
    例如，密码是5601，猜测是1685

    那么 bull 和 cow 和数分别是 1 和 2
</pre>

<p>
计算机和用户相互猜测对方的密码。更少尝试次数的选手为胜利者。如果用户和电脑在相同的尝试次数中破解了密码就是平局
</p>
</div>
<div id="outline-container-org60a3ccf" class="outline-3">
<h3 id="org60a3ccf">数据结构</h3>
<div class="outline-text-3" id="text-org60a3ccf">
<p>
四位数字可以通过向量和计算 bull 以及 cow 的数量高效地表示。这种表达方法需要 <b>构成密码的数字都不相同</b> ：
</p>

<p>
创建长度为10的向量：
</p>
<ul class="org-ul">
<li>每个 <span class="underline">索引</span>  k 的 <span class="underline">值</span> 被设为k在密码中的 <span class="underline">数位</span></li>
<li>四个数位从低到高被计为 1，2，3和4</li>
<li>如果数字没有出现，索引的值为0</li>
</ul>
<pre class="example">
例如，5601和1685可以表示如下：

5601 → #(2 1 0 0 0 4 3 0 0 0)
1685 → #(0 4 0 0 0 1 3 0 2 0)

5601这个例子中，数字0，1，5，和6分别出现在第2，第1，第4和第3位

那么在这个密码的向量表达式里索引0，1，5，6的值分别2是2，1，4和3，其他索引位都是0
</pre>

<p>
这种表达可以快速比较两个数字，如果两个向量的相同索引位的值都是正数情况下：
</p>
<ul class="org-ul">
<li>如果值相等，就计为bull</li>
<li>如果值不相等，就计为cow</li>
</ul>
<pre class="example">
5601和1685这个例子的情况下

索引位6的值都为3，索引位1和索引位5的值都是正数

bull和cow的值为1和2
</pre>
</div>
</div>
<div id="outline-container-orgb1a32cf" class="outline-3">
<h3 id="orgb1a32cf">设计</h3>
<div class="outline-text-3" id="text-orgb1a32cf">
<p>
程序的设计如下：
</p>
<ol class="org-ol">
<li>程序生成一个表，该表包含了所有不同四位数的向量表示</li>
<li>程序从表中随机选取一个数字</li>
<li>重洗步骤（1）产生的表</li>
<li>程序首次猜用户的密码，用户给出 bull 和 cow 的数量。然后用户猜程序的密码，程序给出 Nnull 和 Ncow</li>
<li>重复步骤（3）直到电脑或者程序的bull数量变为 4 为止。如果在同一次双方的数量都变为4，就是平局</li>
</ol>
</div>
</div>
<div id="outline-container-orgf9197d1" class="outline-3">
<h3 id="orgf9197d1">实现</h3>
<div class="outline-text-3" id="text-orgf9197d1">
<p>
(char2int c) : 将字符c ( <span class="underline">#\0</span> ~ <span class="underline">#\9</span> )转换为整数（0 ~ 9）
</p>
<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #00bfff; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #daa520; font-weight: bold;">1-</span> x<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>- x 1<span style="color: #696969;">))</span>

<span style="color: #696969;">(</span><span style="color: #00bfff; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #daa520; font-weight: bold;">char2int</span> c<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span>- <span style="color: #696969;">(</span>char-&gt;integer c<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>char-&gt;integer #\0<span style="color: #696969;">)))</span>
</pre>
</div>

<p>
(ls2nvec ls) : 将四个数字的 <span class="underline">表</span> ls 转换为 <b>向量表达式</b> 
</p>

<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #00bfff; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #daa520; font-weight: bold;">ls2nvec</span> ls<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #00bfff; font-weight: bold;">let</span> <span style="color: #696969;">((</span>vec <span style="color: #696969;">(</span>make-vector 10 0<span style="color: #696969;">)))</span>
    <span style="color: #696969;">(</span><span style="color: #00bfff; font-weight: bold;">let</span> <span style="color: #daa520; font-weight: bold;">loop</span> <span style="color: #696969;">((</span>i <span style="color: #696969;">(</span>length ls<span style="color: #696969;">))</span> <span style="color: #696969;">(</span>ls ls<span style="color: #696969;">))</span>
      <span style="color: #696969;">(</span><span style="color: #00bfff; font-weight: bold;">if</span> <span style="color: #696969;">(</span>&gt; i 0<span style="color: #696969;">)</span>
          <span style="color: #696969;">(</span><span style="color: #00bfff; font-weight: bold;">begin</span>
            <span style="color: #696969;">(</span>vector-set! vec <span style="color: #696969;">(</span>car ls<span style="color: #696969;">)</span> i<span style="color: #696969;">)</span>
            <span style="color: #696969;">(</span>loop <span style="color: #696969;">(</span>1- i<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>cdr ls<span style="color: #696969;">)))</span>
          vec<span style="color: #696969;">))))</span>

<span style="color: #696969;">(</span>ls2nvec '<span style="color: #696969;">(</span>5 3 6 0<span style="color: #696969;">))</span> <span style="color: #5f9ea0; font-style: italic;">; </span><span style="color: #5f9ea0; font-style: italic;">=&gt; #(1 0 0 3 0 4 2 0 0 0)</span>
</pre>
</div>

<p>
(nvec2int vec) : 将 <span class="underline">向量表达式</span> vec转换为普通 <span class="underline">整数</span> 
</p>

<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #00bfff; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #daa520; font-weight: bold;">nvec2int</span> vec<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #00bfff; font-weight: bold;">let</span> <span style="color: #daa520; font-weight: bold;">loop</span> <span style="color: #696969;">((</span>i 0<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>n 0<span style="color: #696969;">))</span>
    <span style="color: #696969;">(</span><span style="color: #00bfff; font-weight: bold;">if</span> <span style="color: #696969;">(</span>= i 10<span style="color: #696969;">)</span>
        n
        <span style="color: #696969;">(</span><span style="color: #00bfff; font-weight: bold;">let</span> <span style="color: #696969;">((</span>j <span style="color: #696969;">(</span>vector-ref vec i<span style="color: #696969;">)))</span>
          <span style="color: #696969;">(</span>loop <span style="color: #696969;">(</span>1+ i<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>+ n <span style="color: #696969;">(</span><span style="color: #00bfff; font-weight: bold;">if</span> <span style="color: #696969;">(</span>&gt; j 0<span style="color: #696969;">)</span>
                                <span style="color: #696969;">(</span>* i <span style="color: #696969;">(</span>expt 10 <span style="color: #696969;">(</span>1- j<span style="color: #696969;">)))</span>
                                0<span style="color: #696969;">)))))))</span>
</pre>
</div>

<p>
(int2str i) : 将一个四位数i转换为字符串。如果i小于1000，'0'被置于高位 
</p>

<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #00bfff; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #daa520; font-weight: bold;">int2str</span> i<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span>string-append
   <span style="color: #696969;">(</span><span style="color: #00bfff; font-weight: bold;">if</span> <span style="color: #696969;">(</span>&lt; i 1000<span style="color: #696969;">)</span> <span style="color: #deb887;">"0"</span> <span style="color: #deb887;">""</span><span style="color: #696969;">)</span>
   <span style="color: #696969;">(</span>number-&gt;string i<span style="color: #696969;">)))</span>
</pre>
</div>

<p>
(read-from-stdin str) : 将 str 显示于 <span class="underline">标准输出</span> ，并返回用户从 <span class="underline">标准输入</span> 输入的字符串 
</p>

<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #00bfff; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #daa520; font-weight: bold;">read-integer</span> str<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span>string-&gt;number <span style="color: #696969;">(</span>read-from-stdin str<span style="color: #696969;">)))</span>

<span style="color: #696969;">(</span><span style="color: #00bfff; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #daa520; font-weight: bold;">read-from-stdin</span> str<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span>display str<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span>newline<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span>read-line<span style="color: #696969;">))</span>
</pre>
</div>

<p>
(write-to-stdout . ls) : 将ls的每个元素都输出到 <span class="underline">标准输出</span> ，并在 <span class="underline">行尾</span> 插入 <span class="underline">行结束符</span> 
</p>

<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #00bfff; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #daa520; font-weight: bold;">write-to-stdout</span> . ls<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #00bfff; font-weight: bold;">for-each</span> <span style="color: #696969;">(</span><span style="color: #00bfff; font-weight: bold;">lambda</span> <span style="color: #696969;">(</span>obj<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>display obj<span style="color: #696969;">))</span> ls<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span>newline<span style="color: #696969;">))</span>
</pre>
</div>

<p>
(str2nvec str) : 将用户输入的表示四位数的 <span class="underline">字符串</span> str转换为 <span class="underline">向量表达式</span> 
</p>
<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #00bfff; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #daa520; font-weight: bold;">str2nvec</span> str<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #00bfff; font-weight: bold;">let</span> <span style="color: #696969;">((</span>vec <span style="color: #696969;">(</span>make-vector 10 0<span style="color: #696969;">)))</span>
    <span style="color: #696969;">(</span><span style="color: #00bfff; font-weight: bold;">let</span> <span style="color: #daa520; font-weight: bold;">loop</span> <span style="color: #696969;">((</span>i <span style="color: #696969;">(</span>string-length str<span style="color: #696969;">))</span> <span style="color: #696969;">(</span>ls <span style="color: #696969;">(</span>string-&gt;list str<span style="color: #696969;">)))</span>
      <span style="color: #696969;">(</span><span style="color: #00bfff; font-weight: bold;">if</span> <span style="color: #696969;">(</span>pair? ls<span style="color: #696969;">)</span>
          <span style="color: #696969;">(</span><span style="color: #00bfff; font-weight: bold;">begin</span>
            <span style="color: #696969;">(</span>vector-set! vec <span style="color: #696969;">(</span>char2int <span style="color: #696969;">(</span>car ls<span style="color: #696969;">))</span> i<span style="color: #696969;">)</span>
            <span style="color: #696969;">(</span>loop <span style="color: #696969;">(</span>1- i<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>cdr ls<span style="color: #696969;">)))</span>
          vec<span style="color: #696969;">))))</span>
</pre>
</div>

<p>
(scoring vec0 vec1) : 以 ( <span class="underline">5*Nbull + Ncow</span> ) 计算两个整数（向量表达式）vec0 和 vec1的 <b>相似程度</b> 
</p>
<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #00bfff; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #daa520; font-weight: bold;">scoring</span> vec0 vec1<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #00bfff; font-weight: bold;">let</span> <span style="color: #696969;">((</span>n <span style="color: #696969;">(</span>vector-length vec0<span style="color: #696969;">)))</span>
    <span style="color: #696969;">(</span><span style="color: #00bfff; font-weight: bold;">let</span> <span style="color: #daa520; font-weight: bold;">loop</span> <span style="color: #696969;">((</span>i 0<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>score 0<span style="color: #696969;">))</span>
      <span style="color: #696969;">(</span><span style="color: #00bfff; font-weight: bold;">if</span> <span style="color: #696969;">(</span>&lt; i n<span style="color: #696969;">)</span>
          <span style="color: #696969;">(</span><span style="color: #00bfff; font-weight: bold;">let</span> <span style="color: #696969;">((</span>d0 <span style="color: #696969;">(</span>vector-ref vec0 i<span style="color: #696969;">))</span>
                <span style="color: #696969;">(</span>d1 <span style="color: #696969;">(</span>vector-ref vec1 i<span style="color: #696969;">)))</span>
            <span style="color: #696969;">(</span>loop <span style="color: #696969;">(</span>1+ i<span style="color: #696969;">)</span>
                  <span style="color: #696969;">(</span>+ score <span style="color: #696969;">(</span><span style="color: #00bfff; font-weight: bold;">if</span> <span style="color: #696969;">(</span><span style="color: #00bfff; font-weight: bold;">and</span> <span style="color: #696969;">(</span>&lt; 0 d0<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>&lt; 0 d1<span style="color: #696969;">))</span>
                               <span style="color: #696969;">(</span><span style="color: #00bfff; font-weight: bold;">if</span> <span style="color: #696969;">(</span>= d0 d1<span style="color: #696969;">)</span> 5 1<span style="color: #696969;">)</span>
                               0<span style="color: #696969;">))))</span>
          score<span style="color: #696969;">))))</span>
</pre>
</div>

<p>
(show-user-score score) : 通过 <span class="underline">相似度score</span> 计算 Nbull 和Ncow，并将它们显示在 <span class="underline">标准输出</span> ：
</p>

<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #00bfff; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #daa520; font-weight: bold;">show-user-score</span> score<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span>write-to-stdout <span style="color: #deb887;">"Number of bulls and cows in your guess:"</span> <span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span>write-to-stdout <span style="color: #deb887;">"bulls: "</span> <span style="color: #696969;">(</span>quotient score 5<span style="color: #696969;">))</span>
  <span style="color: #696969;">(</span>write-to-stdout <span style="color: #deb887;">"cows: "</span> <span style="color: #696969;">(</span>modulo score 5<span style="color: #696969;">))</span>
  <span style="color: #696969;">(</span>newline<span style="color: #696969;">))</span>
</pre>
</div>

<p>
(read-my-score gu0) : 显示 <span class="underline">计算机的猜测</span>  (gu0) ，让用户输入 <span class="underline">Nbull</span> 和 <span class="underline">Ncow</span> ，返回 <b>相似度</b> score
</p>
<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #00bfff; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #daa520; font-weight: bold;">read-my-score</span> gu0<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span>write-to-stdout <span style="color: #deb887;">"My guess is: "</span> <span style="color: #696969;">(</span>int2str <span style="color: #696969;">(</span>nvec2int gu0<span style="color: #696969;">)))</span>
  <span style="color: #696969;">(</span>write-to-stdout <span style="color: #deb887;">"Give number of bulls and cows in my guess."</span> <span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #00bfff; font-weight: bold;">let</span> <span style="color: #696969;">((</span>na5 <span style="color: #696969;">(</span>* 5 <span style="color: #696969;">(</span>read-integer <span style="color: #deb887;">"bulls: "</span><span style="color: #696969;">))))</span>
    <span style="color: #696969;">(</span>+ na5 <span style="color: #696969;">(</span>read-integer <span style="color: #deb887;">"cows: "</span><span style="color: #696969;">))))</span> <span style="color: #5f9ea0; font-style: italic;">; </span><span style="color: #5f9ea0; font-style: italic;">the score is calculated by (5 * bull + cow)</span>
</pre>
</div>
<p>
(read-user-guess)   : 返回 <span class="underline">用户猜测</span> 的 <span class="underline">向量表达式</span> 
</p>
<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #00bfff; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #daa520; font-weight: bold;">read-user-guess</span><span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span>newline<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span>str2nvec <span style="color: #696969;">(</span>read-from-stdin <span style="color: #deb887;">"Give your guess."</span><span style="color: #696969;">)))</span>
</pre>
</div>

<p>
(shuffle-numbers ls0)  :  <b>随机排序</b> ls0。由于有 随机读取的需求，将 ls0转换为 <span class="underline">向量</span> ，然后随机读取向量的元素，以创建一个重排过的表
</p>
<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #00bfff; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #daa520; font-weight: bold;">shuffle-numbers</span> ls0<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #00bfff; font-weight: bold;">let</span> <span style="color: #696969;">((</span>vec <span style="color: #696969;">(</span>list-&gt;vector ls0<span style="color: #696969;">)))</span>
    <span style="color: #696969;">(</span><span style="color: #00bfff; font-weight: bold;">let</span> <span style="color: #daa520; font-weight: bold;">loop</span> <span style="color: #696969;">((</span>n <span style="color: #696969;">(</span>vector-length vec<span style="color: #696969;">))</span> <span style="color: #696969;">(</span>ls1 '<span style="color: #696969;">()))</span>
      <span style="color: #696969;">(</span><span style="color: #00bfff; font-weight: bold;">if</span> <span style="color: #696969;">(</span>= n 0<span style="color: #696969;">)</span>
          ls1
          <span style="color: #696969;">(</span><span style="color: #00bfff; font-weight: bold;">let*</span> <span style="color: #696969;">((</span>r <span style="color: #696969;">(</span>random n<span style="color: #696969;">))</span>
                 <span style="color: #696969;">(</span>v <span style="color: #696969;">(</span>vector-ref vec r<span style="color: #696969;">)))</span>
            <span style="color: #696969;">(</span>vector-set! vec r <span style="color: #696969;">(</span>vector-ref vec <span style="color: #696969;">(</span>1- n<span style="color: #696969;">)))</span>
            <span style="color: #696969;">(</span>loop <span style="color: #696969;">(</span>1- n<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>cons v ls1<span style="color: #696969;">)))))))</span>
</pre>
</div>

<p>
(make-numbers)  : 返回由所有不同四位数构成的表
</p>
<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #00bfff; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #daa520; font-weight: bold;">make-numbers</span><span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #00bfff; font-weight: bold;">let</span> <span style="color: #696969;">((</span>ls1 '<span style="color: #696969;">()))</span>
    <span style="color: #696969;">(</span><span style="color: #00bfff; font-weight: bold;">letrec</span> <span style="color: #696969;">((</span>rec <span style="color: #696969;">(</span><span style="color: #00bfff; font-weight: bold;">lambda</span> <span style="color: #696969;">(</span>i num ls<span style="color: #696969;">)</span>
                    <span style="color: #696969;">(</span><span style="color: #00bfff; font-weight: bold;">if</span> <span style="color: #696969;">(</span>= i 4<span style="color: #696969;">)</span>
                        <span style="color: #696969;">(</span>set! ls1 <span style="color: #696969;">(</span>cons <span style="color: #696969;">(</span>ls2nvec ls<span style="color: #696969;">)</span> ls1<span style="color: #696969;">))</span>
                        <span style="color: #696969;">(</span><span style="color: #00bfff; font-weight: bold;">for-each</span> 
                         <span style="color: #696969;">(</span><span style="color: #00bfff; font-weight: bold;">lambda</span> <span style="color: #696969;">(</span>n<span style="color: #696969;">)</span>
                           <span style="color: #696969;">(</span>rec <span style="color: #696969;">(</span>1+ i<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>delv n num<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>cons n ls<span style="color: #696969;">)))</span>
                         num<span style="color: #696969;">)))))</span>
      <span style="color: #696969;">(</span>rec 0 '<span style="color: #696969;">(</span>0 1 2 3 4 5 6 7 8 9<span style="color: #696969;">)</span> '<span style="color: #696969;">()))</span>
    ls1<span style="color: #696969;">))</span>
</pre>
</div>
<p>
(game-over sc0 sc1)  :  通过比较计算机的得分 (sc0) 和用户的得分 (sc1) 确定胜利者 
</p>
<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #00bfff; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #daa520; font-weight: bold;">game-over</span> sc0 sc1<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span>write-to-stdout
   <span style="color: #696969;">(</span><span style="color: #00bfff; font-weight: bold;">cond</span>
    <span style="color: #696969;">((</span>= sc0 sc1<span style="color: #696969;">)</span> <span style="color: #deb887;">"Draw"</span><span style="color: #696969;">)</span>
    <span style="color: #696969;">((</span>&gt; sc0 sc1<span style="color: #696969;">)</span> <span style="color: #deb887;">"I won."</span><span style="color: #696969;">)</span>
    <span style="color: #696969;">(</span><span style="color: #00bfff; font-weight: bold;">else</span> <span style="color: #deb887;">"You won."</span><span style="color: #696969;">)))</span>
  'game-over<span style="color: #696969;">)</span>
</pre>
</div>

<p>
(scoring-user-guess an0 gu1) : 计算计算机的密码  an0 和用户的猜测 gu1 的相似度，使用 show-uuser-score 输出 Nbull 和 Ncow
</p>
<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #00bfff; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #daa520; font-weight: bold;">scoring-user-guess</span> an0 gu1<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #00bfff; font-weight: bold;">let</span> <span style="color: #696969;">((</span>sc1 <span style="color: #696969;">(</span>scoring an0 gu1<span style="color: #696969;">)))</span>
    <span style="color: #696969;">(</span>show-user-score sc1<span style="color: #696969;">)</span>
    sc1<span style="color: #696969;">))</span>
</pre>
</div>

<p>
(mastermind-rec an0 candidates)  : 主程序，它有两个参数
</p>
<ul class="org-ul">
<li>计算机密码 an0</li>
<li>猜测的表 candidate</li>
</ul>

<p>
主要逻辑：
</p>
<ol class="org-ol">
<li>它计算计算机的得分 sc0 和用户的得分 sc1</li>
<li>如果 sc0 或者 sc1 为20
<ul class="org-ul">
<li>调用 (game-over sc0 sc1)</li>
<li>如果没有值为20，它根据 sc0 过滤猜测的表 candidate，并继续游戏</li>
</ul></li>
</ol>

<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #00bfff; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #daa520; font-weight: bold;">mastermind-rec</span> an0 candidates<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #00bfff; font-weight: bold;">if</span> <span style="color: #696969;">(</span>null? candidates<span style="color: #696969;">)</span>
      <span style="color: #696969;">(</span>error <span style="color: #deb887;">"Error. You gave wrong score for my guess, probably."</span><span style="color: #696969;">)</span>
      <span style="color: #696969;">(</span><span style="color: #00bfff; font-weight: bold;">let</span> <span style="color: #696969;">((</span>gu0 <span style="color: #696969;">(</span>car candidates<span style="color: #696969;">)))</span>
        <span style="color: #696969;">(</span><span style="color: #00bfff; font-weight: bold;">let</span> <span style="color: #696969;">((</span>sc1 <span style="color: #696969;">(</span>scoring-user-guess an0 <span style="color: #696969;">(</span>read-user-guess<span style="color: #696969;">)))</span>
              <span style="color: #696969;">(</span>sc0 <span style="color: #696969;">(</span>read-my-score gu0<span style="color: #696969;">)))</span>
          <span style="color: #696969;">(</span><span style="color: #00bfff; font-weight: bold;">if</span> <span style="color: #696969;">(</span><span style="color: #00bfff; font-weight: bold;">or</span> <span style="color: #696969;">(</span>= sc0 20<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>= sc1 20<span style="color: #696969;">))</span>
              <span style="color: #696969;">(</span>game-over sc0 sc1<span style="color: #696969;">)</span>
              <span style="color: #696969;">(</span>mastermind-rec an0 
                              <span style="color: #696969;">(</span>keep-matching-items 
                               <span style="color: #696969;">(</span>cdr candidates<span style="color: #696969;">)</span>
                               <span style="color: #696969;">(</span><span style="color: #00bfff; font-weight: bold;">lambda</span> <span style="color: #696969;">(</span>x<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>= <span style="color: #696969;">(</span>scoring gu0 x<span style="color: #696969;">)</span> sc0<span style="color: #696969;">)))))))))</span>
</pre>
</div>
<p>
(mastermind) : 在控制台调用该函数以开始游戏
</p>

<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #00bfff; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #daa520; font-weight: bold;">mastermind</span><span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #00bfff; font-weight: bold;">let</span> <span style="color: #696969;">((</span>ls0 <span style="color: #696969;">(</span>make-numbers<span style="color: #696969;">)))</span>
    <span style="color: #696969;">(</span>mastermind-rec <span style="color: #696969;">(</span>list-ref ls0 <span style="color: #696969;">(</span>random <span style="color: #696969;">(</span>length ls0<span style="color: #696969;">)))</span> <span style="color: #696969;">(</span>shuffle-numbers ls0<span style="color: #696969;">))))</span>
</pre>
</div>

<p>
测试：
</p>
<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #696969;">(</span>compile-file <span style="color: #deb887;">"mastermind.scm"</span><span style="color: #696969;">)</span>
<span style="color: #696969;">(</span>load <span style="color: #deb887;">"mastermind"</span><span style="color: #696969;">)</span>
<span style="color: #696969;">(</span>mastermind<span style="color: #696969;">)</span>
</pre>
</div>

<p>
<a href="hashtable.html">Previous：哈希表</a>
</p>

<p>
<a href="slt.html">Home：目录</a>
</p>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">

		  <br/>
		  <div class='ds-thread'></div>
		  <script>
		  var duoshuoQuery = {short_name:'klose911'};
		  (function() {
					  var dsThread = document.getElementsByClassName('ds-thread')[0];
					  dsThread.setAttribute('data-thread-key', document.title);
					  dsThread.setAttribute('data-title', document.title);
					  dsThread.setAttribute('data-url', window.location.href);
					  var ds = document.createElement('script');
					  ds.type = 'text/javascript';ds.async = true;
					  ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
					  ds.charset = 'UTF-8';
					  (document.getElementsByTagName('head')[0] 
						|| document.getElementsByTagName('body')[0]).appendChild(ds);
					  })();
		  </script>
		  <script>
		  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
			(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
			m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
			})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
		  ga('create', 'UA-90850421-1', 'auto');
		  ga('send', 'pageview');
		  </script>
</div>
</body>
</html>
