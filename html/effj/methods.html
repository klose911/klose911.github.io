<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<title>方法</title>
<meta  http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta  name="generator" content="Org-mode" />
<meta  name="author" content="Wu, Shanliang" />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center; }
  .todo   { font-family: monospace; color: red; }
  .done   { color: green; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  pre.src-sh:before    { content: 'sh'; }
  pre.src-bash:before  { content: 'sh'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-R:before     { content: 'R'; }
  pre.src-perl:before  { content: 'Perl'; }
  pre.src-java:before  { content: 'Java'; }
  pre.src-sql:before   { content: 'SQL'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.right  { text-align: center;  }
  th.left   { text-align: center;   }
  th.center { text-align: center; }
  td.right  { text-align: right;  }
  td.left   { text-align: left;   }
  td.center { text-align: center; }
  dt { font-weight: bold; }
  .footpara:nth-child(2) { display: inline; }
  .footpara { display: block; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  /*]]>*/-->
</style>
<link rel="stylesheet" type="text/css" href="css/main.css" />
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2013 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
</head>
<body>
<div id="org-div-home-and-up">
 <a accesskey="h" href="concurrency.html"> UP </a>
 |
 <a accesskey="H" href="effj.html"> HOME </a>
</div><div id="content">
<h1 class="title">方法</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#sec-1">检查参数的有效性</a>
<ul>
<li><a href="#sec-1-1">public方法</a></li>
<li><a href="#sec-1-2">private方法</a></li>
<li><a href="#sec-1-3">总结</a></li>
</ul>
</li>
<li><a href="#sec-2">必要时进行保护性拷贝</a></li>
<li><a href="#sec-3">谨慎设计方法签名</a></li>
<li><a href="#sec-4">慎用重载</a></li>
<li><a href="#sec-5">返回零长度的数组或集合，而不是null</a></li>
<li><a href="#sec-6">为所有导出的API编写Javadoc</a>
<ul>
<li><a href="#sec-6-1">基本原则</a></li>
<li><a href="#sec-6-2">特殊标签</a></li>
<li><a href="#sec-6-3">分类举例</a>
<ul>
<li><a href="#sec-6-3-1">方法</a></li>
<li><a href="#sec-6-3-2">范型</a></li>
<li><a href="#sec-6-3-3">枚举</a></li>
<li><a href="#sec-6-3-4">注解</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>

<div id="outline-container-sec-1" class="outline-2">
<h2 id="sec-1">检查参数的有效性</h2>
<div class="outline-text-2" id="text-1">
</div><div id="outline-container-sec-1-1" class="outline-3">
<h3 id="sec-1-1">public方法</h3>
<div class="outline-text-3" id="text-1-1">
<p>
使用适当的异常来标记参数无效，常用的异常有illegalargumentexception, IndexOutOfBoundsException, NullException, ArithmeticException等，并在Javadoc中使用@throws指明这些异常
</p>

<div class="org-src-container">

<pre class="src src-java"><span style="color: #ffa07a;">/**</span>
<span style="color: #ffa07a;"> * Returns a BigInteger whose value is (this mod m). This method</span>
<span style="color: #ffa07a;"> * differs from the remainder method in that it always returns a</span>
<span style="color: #ffa07a;"> * non-negative BigInteger.</span>
<span style="color: #ffa07a;"> *</span>
<span style="color: #ffa07a;"> * </span><span style="color: #7fffd4;">@param</span><span style="color: #ffa07a;"> m the modulus, which must be positive</span>
<span style="color: #ffa07a;"> * </span><span style="color: #7fffd4;">@return</span><span style="color: #ffa07a;"> this mod m</span>
<span style="color: #ffa07a;"> * </span><span style="color: #7fffd4;">@throws</span><span style="color: #ffa07a;"> ArithmeticException if m is less than or equal to 0</span>
<span style="color: #ffa07a;"> */</span>
<span style="color: #00ffff;">public</span> <span style="color: #98fb98;">BigInteger</span> <span style="color: #87cefa;">mod</span>(<span style="color: #98fb98;">BigInteger</span> <span style="color: #eedd82;">m</span>) {
    <span style="color: #00ffff;">if</span> (m.signum() &lt;= 0)
        <span style="color: #00ffff;">throw</span> <span style="color: #00ffff;">new</span> <span style="color: #98fb98;">ArithmeticException</span>(<span style="color: #ffa07a;">"Modulus &lt;= 0: "</span> + m);
    <span style="color: #ff4500;">// </span><span style="color: #ff4500;">Do the computation</span>
}
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-1-2" class="outline-3">
<h3 id="sec-1-2">private方法</h3>
<div class="outline-text-3" id="text-1-2">
<p>
使用断言来检查参数有效性，私有方法意味着调用者就是编写者。这种情况下可以控制传入的参数，只需要在开发的时候开启断言，在生产的时候关闭断言
</p>
<div class="org-src-container">

<pre class="src src-java"><span style="color: #ff4500;">// </span><span style="color: #ff4500;">Private helper function for a recursive sort</span>
<span style="color: #00ffff;">private</span> <span style="color: #00ffff;">static</span> <span style="color: #98fb98;">void</span> <span style="color: #87cefa;">sort</span>(<span style="color: #98fb98;">long</span> <span style="color: #eedd82;">a</span>[], <span style="color: #98fb98;">int</span> <span style="color: #eedd82;">offset</span>, <span style="color: #98fb98;">int</span> <span style="color: #eedd82;">length</span>) {
    <span style="color: #98fb98;">assert</span> <span style="color: #eedd82;">a</span> != <span style="color: #7fffd4;">null</span>;
    <span style="color: #98fb98;">assert</span> <span style="color: #eedd82;">offset</span> &gt;= 0 &amp;&amp; offset &lt;= a.length;
    <span style="color: #98fb98;">assert</span> <span style="color: #eedd82;">length</span> &gt;= 0 &amp;&amp; length &lt;= a.length - offset;
<span style="color: #ff4500;">// </span><span style="color: #ff4500;">Do the computation</span>
}
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-1-3" class="outline-3">
<h3 id="sec-1-3">总结</h3>
<div class="outline-text-3" id="text-1-3">
<ul class="org-ul">
<li>必须特别注意那些只是用来被保存的参数，比如构造器中的参数往往不会参与运算，一旦设置错误会导致以后难以追查的bug
</li>
<li>有些计算和方法会隐式的执行必要的有效性检查，这种抛出的异常往往需要异常转译
</li>
<li>并不一定参数校验越严厉越好，方法应该追求通用性
</li>
</ul>
</div>
</div>
</div>

<div id="outline-container-sec-2" class="outline-2">
<h2 id="sec-2">必要时进行保护性拷贝</h2>
<div class="outline-text-2" id="text-2">
<p>
总是假设客户端会尽可能地破坏类的约束条件，所以在编写类的时候要考虑防御性
</p>

<p>
粗看BrokenPeriod是一个不可变类
</p>
<div class="org-src-container">

<pre class="src src-java"><span style="color: #ff4500;">// </span><span style="color: #ff4500;">Broken "immutable" time period class</span>
<span style="color: #00ffff;">public</span> <span style="color: #00ffff;">class</span> <span style="color: #98fb98;">BrokenPeriod</span> {

    <span style="color: #00ffff;">private</span> <span style="color: #00ffff;">final</span> <span style="color: #98fb98;">Date</span> <span style="color: #eedd82;">start</span>;
    <span style="color: #00ffff;">private</span> <span style="color: #00ffff;">final</span> <span style="color: #98fb98;">Date</span> <span style="color: #eedd82;">end</span>;

    <span style="color: #ffa07a;">/**</span>
<span style="color: #ffa07a;">     * </span><span style="color: #7fffd4;">@param</span><span style="color: #ffa07a;"> start the beginning of the period</span>
<span style="color: #ffa07a;">     * </span><span style="color: #7fffd4;">@param</span><span style="color: #ffa07a;"> end the end of the period; must not precede start</span>
<span style="color: #ffa07a;">     * </span><span style="color: #7fffd4;">@throws</span><span style="color: #ffa07a;"> IllegalArgumentException if start is after end</span>
<span style="color: #ffa07a;">     * </span><span style="color: #7fffd4;">@throws</span><span style="color: #ffa07a;"> NullPointerException if start or end is null</span>
<span style="color: #ffa07a;">     */</span>
    <span style="color: #00ffff;">public</span> <span style="color: #87cefa;">BrokenPeriod</span>(<span style="color: #98fb98;">Date</span> <span style="color: #eedd82;">start</span>, <span style="color: #98fb98;">Date</span> <span style="color: #eedd82;">end</span>) {
        <span style="color: #00ffff;">if</span> (start.compareTo(end) &gt; 0) {
            <span style="color: #00ffff;">throw</span> <span style="color: #00ffff;">new</span> <span style="color: #98fb98;">IllegalArgumentException</span>(
                start + <span style="color: #ffa07a;">" after "</span> + end);
        }
        <span style="color: #00ffff;">this</span>.start = start;
        <span style="color: #00ffff;">this</span>.end = end;
    }

    <span style="color: #00ffff;">public</span> <span style="color: #98fb98;">Date</span> <span style="color: #87cefa;">start</span>() {
        <span style="color: #00ffff;">return</span> start;
    }

    <span style="color: #00ffff;">public</span> <span style="color: #98fb98;">Date</span> <span style="color: #87cefa;">end</span>() {
        <span style="color: #00ffff;">return</span> end;
    }
}
</pre>
</div>

<p>
对于BrokenPeriod来说不可变的只是start,end成员的引用，但是Date类是可变的，所以start,end内部的属性依旧是可变的
</p>
<div class="org-src-container">

<pre class="src src-java"><span style="color: #ff4500;">// </span><span style="color: #ff4500;">Attack the internals of a Period instance</span>
<span style="color: #98fb98;">Date</span> <span style="color: #eedd82;">start</span> = <span style="color: #00ffff;">new</span> <span style="color: #98fb98;">Date</span>();
<span style="color: #98fb98;">Date</span> <span style="color: #eedd82;">end</span> = <span style="color: #00ffff;">new</span> <span style="color: #98fb98;">Date</span>();
<span style="color: #98fb98;">BrokenPeriod</span> <span style="color: #eedd82;">p</span> = <span style="color: #00ffff;">new</span> <span style="color: #98fb98;">BrokenPeriod</span>(start, end);
System.out.println(p.end());

end.setYear(78); <span style="color: #ff4500;">// </span><span style="color: #ff4500;">Modifies internals of p!</span>
System.out.println(p.end());
</pre>
</div>

<p>
如果要保证类的可变性，请对构造器的参数使用防御性拷贝，并且拷贝必须在校验参数前。注意：保护性拷贝不要使用clone方法，因为clone可以返回一个成员的子类，而这个子类是否安全是未知的
</p>
<div class="org-src-container">

<pre class="src src-java"><span style="color: #ff4500;">// </span><span style="color: #ff4500;">Repaired constructor - makes defensive copies of parameters</span>
<span style="color: #00ffff;">public</span> <span style="color: #87cefa;">Period</span>(<span style="color: #98fb98;">Date</span> <span style="color: #eedd82;">start</span>, <span style="color: #98fb98;">Date</span> <span style="color: #eedd82;">end</span>) {
    <span style="color: #00ffff;">this</span>.start = <span style="color: #00ffff;">new</span> <span style="color: #98fb98;">Date</span>(start.getTime());
    <span style="color: #00ffff;">this</span>.end = <span style="color: #00ffff;">new</span> <span style="color: #98fb98;">Date</span>(end.getTime());
    <span style="color: #00ffff;">if</span> (<span style="color: #00ffff;">this</span>.start.compareTo(<span style="color: #00ffff;">this</span>.end) &gt; 0)
        <span style="color: #00ffff;">throw</span> <span style="color: #00ffff;">new</span> <span style="color: #98fb98;">IllegalArgumentException</span>(start +<span style="color: #ffa07a;">" after "</span>+ end);
}
</pre>
</div>

<p>
但是客户端依旧可以通过start(), end()方法获得成员的对象引用，这些对象内部状态依旧可以被改变
</p>
<div class="org-src-container">

<pre class="src src-java"><span style="color: #ff4500;">// </span><span style="color: #ff4500;">Second attack on the internals of a Period instance</span>
<span style="color: #98fb98;">Date</span> <span style="color: #eedd82;">start</span> = <span style="color: #00ffff;">new</span> <span style="color: #98fb98;">Date</span>();
<span style="color: #98fb98;">Date</span> <span style="color: #eedd82;">end</span> = <span style="color: #00ffff;">new</span> <span style="color: #98fb98;">Date</span>();
<span style="color: #98fb98;">Period</span> <span style="color: #eedd82;">p</span> = <span style="color: #00ffff;">new</span> <span style="color: #98fb98;">Period</span>(start, end);
p.end().setYear(78); <span style="color: #ff4500;">// </span><span style="color: #ff4500;">Modifies internals of p!</span>
</pre>
</div>

<p>
返回私有对象引用也必须是防御性拷贝
</p>
<div class="org-src-container">

<pre class="src src-java"><span style="color: #ff4500;">// </span><span style="color: #ff4500;">Repaired accessors - make defensive copies of internal fields</span>
<span style="color: #00ffff;">public</span> <span style="color: #98fb98;">Date</span> <span style="color: #87cefa;">start</span>() {
    <span style="color: #00ffff;">return</span> <span style="color: #00ffff;">new</span> <span style="color: #98fb98;">Date</span>(start.getTime());
}

<span style="color: #00ffff;">public</span> <span style="color: #98fb98;">Date</span> <span style="color: #87cefa;">end</span>() {
    <span style="color: #00ffff;">return</span> <span style="color: #00ffff;">new</span> <span style="color: #98fb98;">Date</span>(end.getTime());
}
</pre>
</div>

<p>
长度非零的数组总是可变的。把内部数组返回给客户端之前，应该总要进行保护性拷贝，或者给客户端返回该数组的不可变视图
</p>

<p>
保护性拷贝会引起性能问题，如果方法不暴露给客户端，可以考虑不需要进行保护性拷贝
</p>
</div>
</div>

<div id="outline-container-sec-3" class="outline-2">
<h2 id="sec-3">谨慎设计方法签名</h2>
<div class="outline-text-2" id="text-3">
<ul class="org-ul">
<li>谨慎地选择方法的名称
</li>
<li>不要过于追求提供便利的方法,这回导致方法粒度太细
</li>
<li>避免过长的参数列表，同类型的长参数序列格外有害，分解成多个方法或创建辅助嵌套类
</li>
<li>对于参数类型，要优先使用接口而不是类
</li>
<li>避免boolean参数，要优先使用两个元素的枚举类型
</li>
</ul>
</div>
</div>

<div id="outline-container-sec-4" class="outline-2">
<h2 id="sec-4">慎用重载</h2>
<div class="outline-text-2" id="text-4">
<p>
覆盖是动态的，也就是在运行时候决定调用哪个子类的方法
</p>
<div class="org-src-container">

<pre class="src src-java"><span style="color: #00ffff;">public</span> <span style="color: #00ffff;">class</span> <span style="color: #98fb98;">Overriding</span> {
    <span style="color: #00ffff;">public</span> <span style="color: #00ffff;">static</span> <span style="color: #98fb98;">void</span> <span style="color: #87cefa;">main</span>(<span style="color: #98fb98;">String</span>[] <span style="color: #eedd82;">args</span>) {
        <span style="color: #98fb98;">Wine</span>[] <span style="color: #eedd82;">wines</span> = {
            <span style="color: #00ffff;">new</span> <span style="color: #98fb98;">Wine</span>(), <span style="color: #00ffff;">new</span> <span style="color: #98fb98;">SparklingWine</span>(), <span style="color: #00ffff;">new</span> <span style="color: #98fb98;">Champagne</span>()
        };
        <span style="color: #ff4500;">//</span><span style="color: #ff4500;">wine</span>
        <span style="color: #ff4500;">//</span><span style="color: #ff4500;">sparkling wine</span>
        <span style="color: #ff4500;">//</span><span style="color: #ff4500;">champagne</span>
        <span style="color: #00ffff;">for</span> (<span style="color: #98fb98;">Wine</span> <span style="color: #eedd82;">wine</span> : wines) {
            System.out.println(wine.name());
        }
    }
}

<span style="color: #00ffff;">class</span> <span style="color: #98fb98;">Wine</span> {
    <span style="color: #98fb98;">String</span> <span style="color: #87cefa;">name</span>() {
        <span style="color: #00ffff;">return</span> <span style="color: #ffa07a;">"wine"</span>;
    }
}

<span style="color: #00ffff;">class</span> <span style="color: #98fb98;">SparklingWine</span> <span style="color: #00ffff;">extends</span> <span style="color: #98fb98;">Wine</span> {
    <span style="color: #98fb98;">String</span> <span style="color: #87cefa;">name</span>() {
        <span style="color: #00ffff;">return</span> <span style="color: #ffa07a;">"sparkling wine"</span>;
    }
}

<span style="color: #00ffff;">class</span> <span style="color: #98fb98;">Champagne</span> <span style="color: #00ffff;">extends</span> <span style="color: #98fb98;">SparklingWine</span> {
    <span style="color: #98fb98;">String</span> <span style="color: #87cefa;">name</span>() {
        <span style="color: #00ffff;">return</span> <span style="color: #ffa07a;">"champagne"</span>;
    }
}
</pre>
</div>

<p>
但是重载是静态的，在编译的时候就决定了会调用哪个重载方法
</p>
<div class="org-src-container">

<pre class="src src-java"><span style="color: #ff4500;">// </span><span style="color: #ff4500;">Broken! - What does this program print?</span>
<span style="color: #00ffff;">public</span> <span style="color: #00ffff;">class</span> <span style="color: #98fb98;">BrokenCollectionClassifier</span> {

    <span style="color: #00ffff;">public</span> <span style="color: #00ffff;">static</span> <span style="color: #98fb98;">String</span> <span style="color: #87cefa;">classify</span>(<span style="color: #98fb98;">Set</span>&lt;?&gt; <span style="color: #eedd82;">s</span>) {
        <span style="color: #00ffff;">return</span> <span style="color: #ffa07a;">"Set"</span>;
    }

    <span style="color: #00ffff;">public</span> <span style="color: #00ffff;">static</span> <span style="color: #98fb98;">String</span> <span style="color: #87cefa;">classify</span>(<span style="color: #98fb98;">List</span>&lt;?&gt; <span style="color: #eedd82;">lst</span>) {
        <span style="color: #00ffff;">return</span> <span style="color: #ffa07a;">"List"</span>;
    }

    <span style="color: #00ffff;">public</span> <span style="color: #00ffff;">static</span> <span style="color: #98fb98;">String</span> <span style="color: #87cefa;">classify</span>(<span style="color: #98fb98;">Collection</span>&lt;?&gt; <span style="color: #eedd82;">c</span>) {
        <span style="color: #00ffff;">return</span> <span style="color: #ffa07a;">"Unknown Collection"</span>;
    }

    <span style="color: #00ffff;">public</span> <span style="color: #00ffff;">static</span> <span style="color: #98fb98;">void</span> <span style="color: #87cefa;">main</span>(<span style="color: #98fb98;">String</span>[] <span style="color: #eedd82;">args</span>) {
        <span style="color: #98fb98;">Collection</span>&lt;?&gt;[] <span style="color: #eedd82;">collections</span> = {
            <span style="color: #00ffff;">new</span> <span style="color: #98fb98;">HashSet</span>&lt;<span style="color: #98fb98;">String</span>&gt;(),
            <span style="color: #00ffff;">new</span> <span style="color: #98fb98;">ArrayList</span>&lt;<span style="color: #98fb98;">BigInteger</span>&gt;(),
            <span style="color: #00ffff;">new</span> <span style="color: #98fb98;">HashMap</span>&lt;<span style="color: #98fb98;">String</span>, <span style="color: #98fb98;">String</span>&gt;().values()
        };

        <span style="color: #ff4500;">//</span><span style="color: #ff4500;">Unknown Collection</span>
        <span style="color: #ff4500;">//</span><span style="color: #ff4500;">Unknown Collection</span>
        <span style="color: #ff4500;">//</span><span style="color: #ff4500;">Unknown Collection        </span>
        <span style="color: #00ffff;">for</span> (<span style="color: #98fb98;">Collection</span>&lt;?&gt; <span style="color: #eedd82;">c</span> : collections) {
            System.out.println(classify(c));
        }
    }
}
</pre>
</div>

<p>
只提供一个接受Collection&lt;?&gt;参数的方法，在方法内部使用instanceof判断
</p>
<div class="org-src-container">

<pre class="src src-java"><span style="color: #00ffff;">public</span> <span style="color: #00ffff;">static</span> <span style="color: #98fb98;">String</span> <span style="color: #87cefa;">classify</span>(<span style="color: #98fb98;">Collection</span>&lt;?&gt; <span style="color: #eedd82;">c</span>) {
    <span style="color: #00ffff;">return</span> c <span style="color: #00ffff;">instanceof</span> Set ? <span style="color: #ffa07a;">"Set"</span>
        : c <span style="color: #00ffff;">instanceof</span> List ? <span style="color: #ffa07a;">"List"</span> : <span style="color: #ffa07a;">"Unknown Collection"</span>;
}

<span style="color: #00ffff;">public</span> <span style="color: #00ffff;">static</span> <span style="color: #98fb98;">void</span> <span style="color: #87cefa;">main</span>(<span style="color: #98fb98;">String</span>[] <span style="color: #eedd82;">args</span>) {
    <span style="color: #98fb98;">Collection</span>&lt;?&gt;[] <span style="color: #eedd82;">collections</span> = {
        <span style="color: #00ffff;">new</span> <span style="color: #98fb98;">HashSet</span>&lt;<span style="color: #98fb98;">String</span>&gt;(),
        <span style="color: #00ffff;">new</span> <span style="color: #98fb98;">ArrayList</span>&lt;<span style="color: #98fb98;">BigInteger</span>&gt;(),
        <span style="color: #00ffff;">new</span> <span style="color: #98fb98;">HashMap</span>&lt;<span style="color: #98fb98;">String</span>, <span style="color: #98fb98;">String</span>&gt;().values()
    };

    <span style="color: #ff4500;">//</span><span style="color: #ff4500;">Set</span>
    <span style="color: #ff4500;">//</span><span style="color: #ff4500;">List</span>
    <span style="color: #ff4500;">//</span><span style="color: #ff4500;">Unknown Collection        </span>
    <span style="color: #00ffff;">for</span> (<span style="color: #98fb98;">Collection</span>&lt;?&gt; <span style="color: #eedd82;">c</span> : collections) {
        System.out.println(classify(c));
    }
}
</pre>
</div>

<p>
尽量避免提供两个参数数量相同的重载方法！ 
</p>
</div>
</div>

<div id="outline-container-sec-5" class="outline-2">
<h2 id="sec-5">返回零长度的数组或集合，而不是null</h2>
<div class="outline-text-2" id="text-5">
<p>
返回类型为数组或集合的方法没理由返回null，应该是返回一个零长度的数组或集合，这样可以避免客户端做非空校验
</p>

<ul class="org-ul">
<li>正确地从一个列表返回一个数组
</li>
</ul>
<div class="org-src-container">

<pre class="src src-java"><span style="color: #ff4500;">// </span><span style="color: #ff4500;">The right way to return an array from a collection</span>
<span style="color: #00ffff;">private</span> <span style="color: #00ffff;">final</span> <span style="color: #98fb98;">List</span>&lt;<span style="color: #98fb98;">Cheese</span>&gt; <span style="color: #eedd82;">cheesesInStock</span> = ...;
<span style="color: #00ffff;">private</span> <span style="color: #00ffff;">static</span> <span style="color: #00ffff;">final</span> <span style="color: #98fb98;">Cheese</span>[] <span style="color: #eedd82;">EMPTY_CHEESE_ARRAY</span> = <span style="color: #00ffff;">new</span> <span style="color: #98fb98;">Cheese</span>[0];

<span style="color: #ffa07a;">/**</span>
<span style="color: #ffa07a;"> * </span><span style="color: #7fffd4;">@return</span><span style="color: #ffa07a;"> an array containing all of the cheeses in the shop.</span>
<span style="color: #ffa07a;"> */</span>
<span style="color: #00ffff;">public</span> <span style="color: #98fb98;">Cheese</span>[] <span style="color: #87cefa;">getCheeses</span>() {
    <span style="color: #00ffff;">return</span> cheesesInStock.toArray(EMPTY_CHEESE_ARRAY);
}
</pre>
</div>

<ul class="org-ul">
<li>正确地返回一个集合的拷贝
</li>
</ul>
<div class="org-src-container">

<pre class="src src-java"><span style="color: #ff4500;">// </span><span style="color: #ff4500;">The right way to return a copy of a collection</span>
<span style="color: #00ffff;">public</span> <span style="color: #98fb98;">List</span>&lt;<span style="color: #98fb98;">Cheese</span>&gt; <span style="color: #87cefa;">getCheeseList</span>() {
    <span style="color: #00ffff;">if</span> (cheesesInStock.isEmpty())
        <span style="color: #00ffff;">return</span> Collections.emptyList(); <span style="color: #ff4500;">// </span><span style="color: #ff4500;">Always returns same list</span>
    <span style="color: #00ffff;">else</span>
        <span style="color: #00ffff;">return</span> <span style="color: #00ffff;">new</span> <span style="color: #98fb98;">ArrayList</span>&lt;<span style="color: #98fb98;">Cheese</span>&gt;(cheesesInStock);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-6" class="outline-2">
<h2 id="sec-6">为所有导出的API编写Javadoc</h2>
<div class="outline-text-2" id="text-6">
<p>
必须为每个被导出的类、接口、构造器、方法和成员编写Javadoc
</p>
</div>

<div id="outline-container-sec-6-1" class="outline-3">
<h3 id="sec-6-1">基本原则</h3>
<div class="outline-text-3" id="text-6-1">
<ul class="org-ul">
<li>文档注释的第一句话应该是所属元素的概要描述
</li>
<li>同一个类或者接口中的两个成员或者构造器不应该具有同样的概要描述
</li>
<li>应该包含线程安全性
</li>
<li>最好是在源码中和产生的文档中都应该是易于阅读的，如果两者不可兼顾，文档阅读性优先于代码阅读性
</li>
</ul>
</div>
</div>

<div id="outline-container-sec-6-2" class="outline-3">
<h3 id="sec-6-2">特殊标签</h3>
<div class="outline-text-3" id="text-6-2">
<ul class="org-ul">
<li>@code：展示代码
<div class="org-src-container">

<pre class="src src-java"><span style="color: #ffa07a;">/** (</span><span style="color: #7fffd4;">{@code index &lt; 0 || index &gt;= this.size()}</span><span style="color: #ffa07a;">)</span>
</pre>
</div>
</li>

<li>@literal：防止特殊符号被html处理
<div class="org-src-container">

<pre class="src src-java"><span style="color: #ffa07a;">/** The triangle inequality is </span><span style="color: #7fffd4;">{@literal |x + y| &lt; |x| + |y|}</span><span style="color: #ffa07a;">.</span>
</pre>
</div>
</li>
</ul>
</div>
</div>

<div id="outline-container-sec-6-3" class="outline-3">
<h3 id="sec-6-3">分类举例</h3>
<div class="outline-text-3" id="text-6-3">
</div><div id="outline-container-sec-6-3-1" class="outline-4">
<h4 id="sec-6-3-1">方法</h4>
<div class="outline-text-4" id="text-6-3-1">
<p>
应该简洁地描述出方法和客户端之间的约定，列出这个方法所有的前提条件和后置条件，以及可能产生的副作用
</p>
<ul class="org-ul">
<li>@param：确保在文档中说明所有的参数
</li>
<li>@return：确保在文档中说明返回类型
</li>
<li>@throws：确保说明所有的受检查异常，以及尽可能列出抛出的非受检查异常。每个异常需要说明产生的条件
</li>
<li>this一般指的是“调用当前方法的对象引用”
<div class="org-src-container">

<pre class="src src-java"><span style="color: #ffa07a;">/**</span>
<span style="color: #ffa07a;"> * Returns the element at the specified position in this list.</span>
<span style="color: #ffa07a;"> *</span>
<span style="color: #ffa07a;"> * </span><span style="color: #7fffd4;">&lt;p&gt;</span><span style="color: #ffa07a;">This method is </span><span style="color: #7fffd4;">&lt;i&gt;</span><span style="color: #ffa07a;">not</span><span style="color: #7fffd4;">&lt;/i&gt;</span><span style="color: #ffa07a;"> guaranteed to run in constant</span>
<span style="color: #ffa07a;"> * time. In some implementations it may run in time proportional</span>
<span style="color: #ffa07a;"> * to the element position.</span>
<span style="color: #ffa07a;"> *</span>
<span style="color: #ffa07a;"> * </span><span style="color: #7fffd4;">@param</span><span style="color: #ffa07a;"> index index of element to return; must be</span>
<span style="color: #ffa07a;"> *</span>
<span style="color: #ffa07a;"> non-negative and less than the size of this list</span>
<span style="color: #ffa07a;"> * </span><span style="color: #7fffd4;">@return</span><span style="color: #ffa07a;"> the element at the specified position in this list</span>
<span style="color: #ffa07a;"> * </span><span style="color: #7fffd4;">@throws</span><span style="color: #ffa07a;"> IndexOutOfBoundsException if the index is out of range</span>
<span style="color: #ffa07a;"> *</span>
<span style="color: #ffa07a;"> (</span><span style="color: #7fffd4;">{@code index &lt; 0 || index &gt;= this.size()}</span><span style="color: #ffa07a;">)</span>
<span style="color: #ffa07a;">*/</span>
<span style="color: #98fb98;">E</span> <span style="color: #87cefa;">get</span>(<span style="color: #98fb98;">int</span> <span style="color: #eedd82;">index</span>);
</pre>
</div>
</li>
</ul>
</div>
</div>

<div id="outline-container-sec-6-3-2" class="outline-4">
<h4 id="sec-6-3-2">范型</h4>
<div class="outline-text-4" id="text-6-3-2">
<p>
确保描述所有的类型参数
</p>
<div class="org-src-container">

<pre class="src src-java"><span style="color: #ffa07a;">/**</span>
<span style="color: #ffa07a;"> * An object that maps keys to values. A map cannot contain</span>
<span style="color: #ffa07a;"> * duplicate keys; each key can map to at most one value.</span>
<span style="color: #ffa07a;"> *</span>
<span style="color: #ffa07a;"> * (Remainder omitted)</span>
<span style="color: #ffa07a;"> *</span>
<span style="color: #ffa07a;"> * </span><span style="color: #7fffd4;">@param</span><span style="color: #ffa07a;"> </span><span style="color: #7fffd4;">&lt;K&gt;</span><span style="color: #ffa07a;"> the type of keys maintained by this map</span>
<span style="color: #ffa07a;"> * </span><span style="color: #7fffd4;">@param</span><span style="color: #ffa07a;"> </span><span style="color: #7fffd4;">&lt;V&gt;</span><span style="color: #ffa07a;"> the type of mapped values</span>
<span style="color: #ffa07a;"> */</span>
<span style="color: #00ffff;">public</span> <span style="color: #00ffff;">interface</span> <span style="color: #98fb98;">Map</span>&lt;<span style="color: #98fb98;">K</span>, <span style="color: #98fb98;">V</span>&gt; {
    ... <span style="color: #ff4500;">// </span><span style="color: #ff4500;">Remainder omitted</span>
}
</pre>
</div>
</div>
</div>


<div id="outline-container-sec-6-3-3" class="outline-4">
<h4 id="sec-6-3-3">枚举</h4>
<div class="outline-text-4" id="text-6-3-3">
<p>
确保中说明所有的常量
</p>
<div class="org-src-container">

<pre class="src src-java"><span style="color: #ffa07a;">/**</span>
<span style="color: #ffa07a;"> * An instrument section of a symphony orchestra.</span>
<span style="color: #ffa07a;"> */</span>
<span style="color: #00ffff;">public</span> <span style="color: #00ffff;">enum</span> <span style="color: #98fb98;">OrchestraSection</span> {
<span style="color: #ffa07a;">/** Woodwinds, such as flute, clarinet, and oboe. */</span>
    <span style="color: #eedd82;">WOODWIND</span>,
<span style="color: #ffa07a;">/** Brass instruments, such as french horn and trumpet. */</span>
    <span style="color: #eedd82;">BRASS</span>,
<span style="color: #ffa07a;">/** Percussion instruments, such as timpani and cymbals */</span>
    <span style="color: #eedd82;">PERCUSSION</span>,
<span style="color: #ffa07a;">/** Stringed instruments, such as violin and cello. */</span>
    <span style="color: #eedd82;">STRING</span>;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-6-3-4" class="outline-4">
<h4 id="sec-6-3-4">注解</h4>
<div class="outline-text-4" id="text-6-3-4">
<p>
确保在文档中说明所有成员，以及类型本身
</p>
<div class="org-src-container">

<pre class="src src-java"><span style="color: #ffa07a;">/**</span>
<span style="color: #ffa07a;"> * Indicates that the annotated method is a test method that</span>
<span style="color: #ffa07a;"> * must throw the designated exception to succeed.</span>
<span style="color: #ffa07a;"> */</span>
<span style="color: #7fffd4;">@Retention</span>(<span style="color: #7fffd4;">RetentionPolicy</span>.<span style="color: #98fb98;">RUNTIME</span>)
<span style="color: #7fffd4;">@Target</span>(<span style="color: #7fffd4;">ElementType</span>.<span style="color: #98fb98;">METHOD</span>)
<span style="color: #00ffff;">public</span> <span style="color: #00ffff;">@interface</span> <span style="color: #98fb98;">ExceptionTest</span> {
<span style="color: #ffa07a;">/**</span>
<span style="color: #ffa07a;"> * The exception that the annotated test method must throw</span>
<span style="color: #ffa07a;"> * in order to pass. (The test is permitted to throw any</span>
<span style="color: #ffa07a;"> * subtype of the type described by this class object.)</span>
<span style="color: #ffa07a;"> */</span>
    <span style="color: #98fb98;">Class</span>&lt;? <span style="color: #00ffff;">extends</span> <span style="color: #98fb98;">Exception</span>&gt; <span style="color: #87cefa;">value</span>();
}
</pre>
</div>
<p>
<a href="principle.html">Next：通用原则</a>   
</p>

<p>
<a href="concurrency.html">Previous：同步</a>
</p>

<p>
<a href="effj.html">Home：目录</a>
</p>
</div>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">

     <br/>
    <div class='ds-thread'></div>
<script>
var duoshuoQuery = {short_name:'klose911'};
(function() {
	 var dsThread = document.getElementsByClassName('ds-thread')[0];
         dsThread.setAttribute('data-thread-key', document.title);
         dsThread.setAttribute('data-title', document.title);
         dsThread.setAttribute('data-url', window.location.href);
	 var ds = document.createElement('script');
	 ds.type = 'text/javascript';ds.async = true;
	 ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
	 ds.charset = 'UTF-8';
	 (document.getElementsByTagName('head')[0] 
				       || document.getElementsByTagName('body')[0]).appendChild(ds);
				       })();
</script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-90850421-1', 'auto');
  ga('send', 'pageview');
</script>
</div>
</body>
</html>
