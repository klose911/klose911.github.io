#+TITLE: 集合
#+HTML_HEAD: <link rel="stylesheet" type="text/css" href="../css/main.css" />
#+HTML_LINK_UP: ./list.html
#+HTML_LINK_HOME: ./data_type.html
#+OPTIONS: num:nil timestamp:nil ^:nil

_REDIS_SET_  *集合* 是 _SADD_ ,  _SRANDMEMBER_ 等命令的操作对象， 它使用 _REDIS_ENCODING_INTSET_ 和 _REDIS_ENCODING_HT_ 两种方式编码：
#+ATTR_HTML: image :width 90% 
[[file:../pic/graphviz-2f54a5b62b3507f0e6d579358e426c78b0dfbd5c.svg]]

* 编码
*第一个* 添加到集合的元素， 决定了创建集合时所使用的编码：
+ 如果第一个元素可以表示为 _long long_ 类型值（也即是它是一个 *整数* ）， 那么集合的初始编码为 _REDIS_ENCODING_INTSET_
+ 否则，集合的初始编码为 REDIS_ENCODING_HT

** 切换
如果一个集合使用 REDIS_ENCODING_INTSET 编码， 那么当以下任何一个条件被满足时， 这个集合会被转换成 REDIS_ENCODING_HT 编码：
+ intset 保存的 _整数值个数_ 超过 _server.set_max_intset_entries_ （默认值为 _512_ ）
+ 试图往集合里添加一个新元素，并且这个元素 *不能* 被表示为 long long 类型（也即是，它不是一个整数）

** 字典
当使用 _REDIS_ENCODING_HT_ 编码时， 集合将 _元素_ 保存到 _字典的键_ 里面， 而字典的值则统一设为 _NULL_ 。作为例子， 以下展示了一个以 REDIS_ENCODING_HT 编码表示的集合， 集合的成员为 elem1 、 elem2 和 elem3 ：

#+ATTR_HTML: image :width 90% 
[[file:../pic/graphviz-3b62c50ed475dc6c91adbb8079f0e0104f644931.svg]]

